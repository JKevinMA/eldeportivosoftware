<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0">Generar Orden de Confeccion</h1>
            </div>
        </div>
    </div>
</div>
<section class="content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">
                            Consultar Ordenes de Pedido
                        </h3>

                    </div>
                    <div class="card-body p-0">
                        <div class="tab-content">
                            <div class="p-3" style="display: flex; justify-content:end;align-items: center;">
                                <!-- <p *ngIf="invalido" style="color:rgb(189, 29, 29);font-size: 0.8rem;padding: 0;margin:0;margin-right: 10px;">* Campo inválido, se solicita que ingrese solo caracteres alfabéticos</p> -->
                                <label for="ordenPedido">Ingrese Orden de Pedido:</label>
                                <input style="width: 200px;" [(ngModel)]="busqueda" (keydown)="buscarOrdenPedido()"
                                    type="text" class="form-control ml-2 " id="ordenPedido" placeholder="OP050">
                            </div>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Nro Orden Pedido</th>
                                            <th>Cliente</th>
                                            <th>Direccion</th>
                                            <th>Telefono</th>
                                            <th>Descripcion Producto</th>
                                            <th>Talla</th>
                                            <th>Cantidad</th>
                                            <th>F. Creacion</th>
                                            <th>F. Entrega </th>
                                            <th>F. Estado </th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <ng-container *ngFor="let pedido of ordenesPedidosFiltrados">
                                            <tr *ngFor="let item of pedido.detalles;let i =index">
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="pedido.detalles.length">{{pedido.idOrdenPedido}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="pedido.detalles.length">{{pedido.nombres}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="pedido.detalles.length">{{pedido.direccion}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="pedido.detalles.length">{{pedido.telefono}}</td>
                                                <td style="padding-left:0;">{{item.prenda}}</td>
                                                <td style="padding-left:0;">{{item.talla}}</td>
                                                <td style="padding-left:0;">{{item.cantidad}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="pedido.detalles.length">{{pedido.fechaRecepcion |
                                                    date:'dd-MM-yyyy'}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="pedido.detalles.length">{{pedido.fechaEntrega |
                                                    date:'dd-MM-yyyy'}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="pedido.detalles.length">{{pedido.estado}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="pedido.detalles.length"
                                                    (change)="pedido.seleccionado= !pedido.seleccionado"><input
                                                        type="checkbox"></td>
                                            </tr>
                                        </ng-container>

                                    </tbody>
                                </table>
                            </div>
                            <div class="p-3" style="display: flex; justify-content:end;align-items: center;">
                                <button [disabled]="ordenesPedidosFiltrados.length==0" (click)="agregarOrdenPedido()"
                                    class="btn btn-primary"> <i class="fas fa-plus"></i>&nbsp; Agregar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-12">
                <div class="card  card-primary">
                    <div class="card-header">
                        <h3 class="card-title">
                            Ficha E/S Material
                        </h3>
                    </div>
                    <div class="card-body p-0">
                        <div class="tab-content">
                            <div class="p-3" style="display: flex; justify-content:end;align-items: center;">
                                <!-- <p *ngIf="invalido" style="color:rgb(189, 29, 29);font-size: 0.8rem;padding: 0;margin:0;margin-right: 10px;">* Campo inválido, se solicita que ingrese solo caracteres alfabéticos</p> -->
                                <label for="nroFichaES">Ingrese Numero de Ficha E/S:</label>
                                <input style="width: 200px;" [(ngModel)]="busquedaFicha" (keydown)="buscarFichaES()"
                                    type="text" class="form-control ml-2 " id="nroFichaES" placeholder="FES014">
                            </div>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Nro Ficha E/S</th>
                                            <th>Descripción Material</th>
                                            <th>Cantidad Solicitada</th>
                                            <th>Cantidad Salida</th>
                                            <th>Unidad de Medida</th>
                                            <th>Fecha Generada</th>
                                            <th>Concepto</th>
                                            <th>Estado</th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <ng-container *ngFor="let ficha of fichasESFiltrados">
                                            <tr *ngFor="let item of ficha.detalles;let i =index">
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="ficha.detalles.length">{{ficha.idFichaES}}</td>
                                                <td style="padding-left:0;">{{item.material}}</td>
                                                <td style="padding-left:0;">{{item.cantidadRequerida}}</td>
                                                <td style="padding-left:0;">{{item.cantidadSalida}}</td>
                                                <td style="padding-left:0;">{{item.presentacion}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="ficha.detalles.length">{{ficha.fechaGenerada |
                                                    date:'dd-MM-yyyy'}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="ficha.detalles.length">{{ficha.concepto}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="ficha.detalles.length">{{ficha.estado}}</td>
                                                <td style="vertical-align: middle" *ngIf="i==0"
                                                    [rowSpan]="ficha.detalles.length"
                                                    (change)="ficha.seleccionado= !ficha.seleccionado"><input
                                                        type="checkbox"></td>
                                            </tr>
                                        </ng-container>

                                    </tbody>
                                </table>
                            </div>
                            <div class="p-3" style="display: flex; justify-content:end;align-items: center;">
                                <button (click)="agregarFichaES()"
                                    [disabled]="fichasESFiltrados.length==0 || !ordenPedido.idOrdenPedido"
                                    class="btn btn-primary" ficxha> <i class="fas fa-plus"></i>&nbsp; Agregar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-12">
                <div class="card card-success">
                    <div class="card-header">
                        <h3 class="card-title">
                            Orden de Confección
                        </h3>
                    </div>
                    <div class="card-body p-3">
                        <div class="tab-content">
                            <div style="display: flex; align-items: center; flex-wrap: wrap;">
                                <label for="">Nro Orden Confeccion:</label>
                                <input type="text" style="width:150px;margin-left: 10px;" class="form-control"
                                    placeholder="OCF003" [value]="ordenConfeccion.idOrdenConfeccion" readonly>
                                <label for="" style="margin-left: 15px;">Fecha:</label>
                                <input type="text" style="width:150px;margin-left: 10px;" class="form-control"
                                    [value]="fecha" readonly>
                                <label for="" style="margin-left: 15px;">Generado por:</label>
                                <input type="text" style="width:150px;margin-left: 10px;" class="form-control"
                                    placeholder="Lopez Joel" [value]="user.nombres +' ' +user.apellidos" readonly>
                                <label for="" style="margin-left: 15px;">Tipo de Produccion:</label>
                                <input type="radio" (change)="tipoProduccionParcial= !tipoProduccionCompleta" style="margin-left: 10px;" name="tipoProduccion" id="completa">
                                <label for="completa" style="margin-left: 10px;">Completa</label>
                                <input type="radio"  (change)="tipoProduccionParcial= !tipoProduccionParcial" style="margin-left: 10px;" name="tipoProduccion" id="parcial">
                                <label for="parcial" style="margin-left: 10px;">Parcial</label>
                            </div>
                            <br>
                            <div class="row">
                                <div class="col-6">
                                    <h5 style="text-decoration: underline;">Descripcion Pedido</h5>
                                    <div style="display: flex; align-items: center;" class="mt-3 mb-2">
                                        <label for="nroOP">Nro Orden Pedido:</label>
                                        <input style="margin-left: 10px;width: 150px;" class="form-control" type="text"
                                            name="" id="nroOP" readonly placeholder="OP000"
                                            [value]="ordenPedido.idOrdenPedido || '-'">
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Cliente</th>
                                                    <th>Direccion</th>
                                                    <th>Telefono</th>
                                                    <th>Descripcion Producto</th>
                                                    <th>Talla</th>
                                                    <th>Cantidad</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <ng-container *ngFor="let pedido of [ordenPedido]">
                                                    <tr *ngFor="let item of pedido.detalles;let i =index">
                                                        <td style="vertical-align: middle" *ngIf="i==0"
                                                            [rowSpan]="pedido.detalles.length">{{(i+1)}}</td>
                                                        <td style="vertical-align: middle" *ngIf="i==0"
                                                            [rowSpan]="pedido.detalles.length">{{pedido.nombres}}</td>
                                                        <td style="vertical-align: middle" *ngIf="i==0"
                                                            [rowSpan]="pedido.detalles.length">{{pedido.direccion}}</td>
                                                        <td style="vertical-align: middle" *ngIf="i==0"
                                                            [rowSpan]="pedido.detalles.length">{{pedido.telefono}}</td>
                                                        <td style="padding-left:0;">{{item.prenda}}</td>
                                                        <td style="padding-left:0;">{{item.talla}}</td>
                                                        <td style="padding-left:0;">{{item.cantidad}}</td>
                                                    </tr>
                                                </ng-container>
                                            </tbody>

                                        </table>
                                    </div>
                                    <label>Detalle Orden Pedido:</label>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Item</th>
                                                    <th>Descripcion Producto</th>
                                                    <th>Talla</th>
                                                    <th>Especificacion Diseño</th>
                                                    <th>Cantidad</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr *ngFor="let item of ordenPedido.detalles;let i = index;">
                                                    <td>{{(i+1)}}</td>
                                                    <td>{{item.prenda}}</td>
                                                    <td>{{item.talla}}</td>
                                                    <td>{{item.descripcion}}</td>
                                                    <td><input [(ngModel)]="item.cantidadFabricar" type="number" class="form-control" name="" id=""></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <h5 style="text-decoration: underline;">Materiales de Fabricacion</h5>
                                    <div style="display: flex; align-items: center;" class="mt-3 mb-2">
                                        <label for="nroFES">Nro Ficha E/S:</label>
                                        <input style="margin-left: 10px;width: 150px;" class="form-control" type="text"
                                            name="" id="nroFES" placeholder="OP050">
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th>Descripcion Material</th>
                                                    <th>Cantidad Solicitada</th>
                                                    <th>Cantidad Salida</th>
                                                    <th>Unidad Medida</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <tr  *ngFor="let item of fichaES.detalles">
                                                    <td>{{item.material}}</td>
                                                    <td>{{item.cantidadRequerida}}</td>
                                                    <td>{{item.cantidadSalida}}</td>
                                                    <td>{{item.presentacion}}</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class="row">
                                        <div class="col-6">
                                            <div class="row">
                                                <div class="col-12">
                                                    <button
                                                        [disabled]=" !fichaES.idFichaES || !tipoProduccionParcial"
                                                        class="btn btn-sm btn-primary"> <i
                                                            class="fas fa-check"></i>&nbsp; Generar nueva orden de
                                                        pedido</button>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-6">
                                            <h5 style="text-decoration: underline;">Seccion Devolucion</h5>
                                            <div class="row">
                                                <div class="col-12">
                                                    <div class="">
                                                        <input type="checkbox" name="estado" id="devolucion"
                                                            placeholder="OP050">
                                                        <label style="margin-left:10px"
                                                            for="devolucion">Devolución</label>
                                                    </div>
                                                    <button
                                                        [disabled]="!fichaES.idFichaES || !ordenPedido.idOrdenPedido"
                                                        class="btn btn-sm btn-primary">Gen. Nota de Crédito</button>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="p-2 mb-4" style="display: flex; justify-content:space-between;">
            <button class="btn btn-danger">
                <i class="fas fa-times"></i>
                &nbsp; Salir
            </button>
            <button (click)="registrar()" [disabled]="!fichaES.idFichaES || !ordenPedido.idOrdenPedido" class="btn btn-success">
                <i class="fas fa-check-circle"></i>
                &nbsp; Generar Orden de Confección
            </button>
        </div>
    </div>
</section>